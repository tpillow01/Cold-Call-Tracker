<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cold Call Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="theme-color" content="#cc0000" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}" />
  <style>
    /* tiny helpers only */
    .month-header{cursor:pointer;background:#222}
    .month-header td{font-weight:700;text-align:left}
    .btn-row{display:flex;gap:8px;justify-content:center}
    /* show the modal using the global .modal styles */
    .modal.show{display:flex;animation:zoomIn .3s ease forwards}
  </style>

  <script>
    function toggleMonth(month){
      const rows = document.querySelectorAll(`.month-${month.replace(/\s/g,'-')}`);
      rows.forEach(r => r.style.display = (r.style.display === 'table-row') ? 'none' : 'table-row');
    }
    function openModal(){
      const m = document.getElementById('callModal');
      m.classList.add('show');
    }
    function closeModal(){
      const m = document.getElementById('callModal');
      m.classList.remove('show');
    }
  </script>
</head>
<body>
  <!-- Top header -->
  <div class="top-header">
    <img src="{{ url_for('static', filename='tynan_logo.png') }}" class="logo-img" alt="Tynan" />
    <h1>Welcome, {{ user }}</h1>
    <img src="{{ url_for('static', filename='heli_logo.png') }}" class="logo-img" alt="HELI" />
  </div>

  <div class="main-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2>Menu</h2>
      <a href="/schedule" class="btn">üìÖ Schedule</a>
      <button class="btn" type="button" onclick="openModal()">üìû Log New Call</button>
      <a href="/logout" class="btn btn-logout">Logout</a>
    </aside>

    <!-- Content -->
    <div class="content">
      <!-- Reminders -->
      <section class="card">
        <h2>Reminders</h2>
        {% for reminder in reminders %}
          <div class="reminder-card">
            <h3>{{ reminder['company'] }}</h3>
            <p>Last contacted: {{ reminder['days_ago'] }} days ago</p>
            <p>Suggested Action: <strong>{{ reminder['action'] }}</strong></p>
          </div>
        {% else %}
          <p>No follow-ups due today.</p>
        {% endfor %}
      </section>

      <!-- Past Cold Calls -->
      <section class="card">
        <h2>Past Cold Calls</h2>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Company</th>
                <th>Contact Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Notes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for month, calls in calls_by_month.items() %}
                <tr class="month-header" onclick="toggleMonth('{{ month }}')">
                  <td colspan="7">{{ month }}</td>
                </tr>
                {% for call in calls %}
                  <tr class="call-row month-{{ month.replace(' ', '-') }}" style="display:none;">
                    <td>{{ call['company'] }}</td>
                    <td>{{ call['contact_name'] or '‚Äî' }}</td>
                    <td>{{ call['email'] or '‚Äî' }}</td>
                    <td>{{ call['phone'] or '‚Äî' }}</td>
                    <td>{{ call['address'] or '‚Äî' }}</td>
                    <td style="white-space:pre-wrap">{{ call['notes'] or '‚Äî' }}</td>
                    <td>
                      <div class="btn-row">
                        <a href="/edit_call/{{ call['id'] }}" class="btn" style="padding:6px 10px;font-size:14px;width:auto">Edit</a>
                        <a href="/delete_call/{{ call['id'] }}" class="btn" style="padding:6px 10px;font-size:14px;width:auto;background:#cc0000"
                           onclick="return confirm('Are you sure?')">Delete</a>
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </div>

  <!-- Modal: Log New Call (uses global .modal/.modal-content styles) -->
  <div class="modal" id="callModal" aria-hidden="true">
    <div class="modal-content">
      <button class="close" type="button" onclick="closeModal()">√ó</button>
      <h2>Log a New Cold Call</h2>
      <form action="/add" method="POST" class="grid-form">
        <div class="form-group">
          <label for="company">Company</label>
          <input id="company" type="text" name="company" required />
        </div>
        <div class="form-group">
          <label for="contact_name">Contact Name</label>
          <input id="contact_name" type="text" name="contact_name" />
        </div>
        <div class="form-group">
          <label for="phone">Phone</label>
          <input id="phone" type="text" name="phone" />
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input id="email" type="email" name="email" />
        </div>
        <div class="form-group full">
          <label for="address">Address</label>
          <input id="address" type="text" name="address" />
        </div>
        <div class="form-group full">
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes" rows="3"></textarea>
        </div>
        <div class="form-group full">
          <button type="submit" class="btn">Add Call</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/static/sw.js')
        .then(() => console.log('‚úÖ Service Worker Registered'))
        .catch(err => console.error('‚ùå Service Worker Error:', err));
    }
  </script>
</body>
</html>
